<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
    xmlns:vm="clr-namespace:Zaczy.SongBook.MAUI.ViewModels"
    xmlns:data="clr-namespace:Zaczy.SongBook.Data;assembly=Zaczy.SongBook"
    x:Class="Zaczy.SongBook.MAUI.Pages.SongDetailsPage"
    x:Name="Root"
    x:DataType="data:SongEntity"
    BackgroundColor="White"
    Title="{Binding Title}">
    
    <Grid Padding="12,12,12,0" RowDefinitions="Auto,Auto,Auto,Auto,*">
        <HorizontalStackLayout
            Grid.Row="0"
            >
            <Button 
                Grid.Row="0"
                x:Name="BackButton"
                Text="&#xFFE9;"
                WidthRequest="26"
                HeightRequest="36"
                Clicked="OnBackClicked"
                Background="Transparent"
                FontSize="30"
                Padding="0"
                HorizontalOptions="Start"
                VerticalOptions="Center"
                Margin="-15,-11,-5,0"
                TextColor="#AAA"
                IsVisible="False" 
                />
            <Label 
                x:Name="TitleLabel" 
                Grid.Row="0" Text="{Binding Title}" 
                FontAttributes="Bold" 
                FontSize="{OnIdiom Phone=20, Tablet=24, Desktop=24}"
                TextColor="#666" />
        </HorizontalStackLayout>

        <HorizontalStackLayout Grid.Row="0" HorizontalOptions="End">
        <Label Grid.Row="0" 
               Text="{Binding Artist}" 
               FontSize="{OnIdiom Phone=14, Tablet=18, Desktop=20}"
               
               TextColor="Gray" 
               Padding="0,0,0,0"
               />

        <Button 
            Grid.Row="0"
            WidthRequest="24"
            HeightRequest="24" 
            x:Name ="ScrollToggleQuick"
            Clicked="OnScrollToggleClicked"
            Background="Transparent"
            TextColor="Black"
            FontSize="10"
            Padding="0,0,0,0"
            HorizontalOptions="End"
            Margin="0,-10,-10,0"
            mi:MauiIcon.Value="{Binding Source={x:Reference Root}, Path=UserViewModel.PlayIcon}"
            MinimumHeightRequest="30"
            MinimumWidthRequest="30"
            />
        </HorizontalStackLayout>
        <!--             Text="{Binding Source={x:Reference Root}, Path=UserViewModel.ScrollingTextShort}" -->
        <!-- mi:MauiIcon.Value="{mi:FontAwesomeSolid Icon=Play}" -->


        <BoxView Grid.Row="3" HeightRequest="1" BackgroundColor="#ddd" />

        <WebView Grid.Row="4"
             x:Name="LyricsWebView"
             />

    <!-- Transparent touch area above the WebView to detect taps at the top of the page.
         Placed after WebView so it overlays it, and before ControlsPanel so controls remain top-most. -->
    <BoxView 
        x:Name="TopTouchArea"
        Grid.Row="0"
        Grid.ColumnSpan="1"
        Grid.RowSpan="3"
        HeightRequest="40"
        VerticalOptions="Start"
        BackgroundColor="Transparent"
        Opacity="0.6"
        Margin="0,0,40,0"
        >
      <BoxView.GestureRecognizers>
        <TapGestureRecognizer Tapped="OnTopTouched" NumberOfTapsRequired="1" />
      </BoxView.GestureRecognizers>
    </BoxView>

    <HorizontalStackLayout x:Name="ControlsPanel"
                           Grid.Row="0"
                           Grid.RowSpan="5"
                           Padding="12"
                           Spacing="12"
                           VerticalOptions="Start"
                           BackgroundColor="#80000000"
                           IsVisible="False"
                           Opacity="0">
        <!-- bind to the UserViewModel exposed on the page with x:Reference -->
        <ImageButton
            x:Name="ScrollToggle"
            Clicked="OnScrollTogglePanelClicked"
            MinimumHeightRequest="32"
            MinimumWidthRequest="32"
            BackgroundColor="Transparent"
            mi:MauiIcon.Value="{Binding Source={x:Reference Root}, Path=UserViewModel.ToggleIcon}" />
        <ImageButton 
            Source="{mi:Fluent FontIncrease24, IconSize=30, IconColor=#FFF}"
            Clicked="OnIncreaseFontClicked" 
            />
        <ImageButton 
            Source="{mi:Fluent FontDecrease24, IconSize=30, IconColor=#FFF}"
            Clicked="OnDecreaseFontClicked" />
        <ImageButton 
            Source="{mi:Fluent ApprovalsApp20, IconSize=30, IconColor=#FFF}"
            Clicked="OnResetFontClicked" 
            />

        <ImageButton
            Source="{mi:FontAwesomeSolid Gear, IconSize=30, IconColor=#FFF}"
            Clicked="OnSettingsClicked"
            MinimumHeightRequest="32"
            MinimumWidthRequest="32"
        />

         <mi:MauiIcon Icon="{mi:FluentIcons FontDecrease24}" IconSize="32" IconColor="#AAA" />

        </HorizontalStackLayout>
  </Grid>
</ContentPage>