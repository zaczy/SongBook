<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
    xmlns:vm="clr-namespace:Zaczy.SongBook.MAUI.ViewModels"
    xmlns:data="clr-namespace:Zaczy.SongBook.Data;assembly=Zaczy.SongBook"
    xmlns:pages="clr-namespace:Zaczy.SongBook.MAUI.Pages"
    x:Class="Zaczy.SongBook.MAUI.Pages.SongDetailsPage"
    x:Name="Root"
    x:DataType="pages:SongDetailsPage"
    BackgroundColor="White"
    Title="{Binding Source={x:Reference Root}, Path=Song.Title}">

    <Grid Padding="12,0,12,0" RowDefinitions="Auto,Auto,Auto,Auto,*" x:DataType="data:SongEntity">
        <Grid Grid.Row="0" Padding="0,3,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="{OnIdiom 20, Tablet=40}" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="{OnIdiom 20, Tablet=40}" />
            </Grid.ColumnDefinitions>

            <Button 
                    Grid.Row="0"
                    Grid.Column="0"
                    x:Name="BackButton"
                    Text="&#xFFE9;"
                    WidthRequest="36"
                    HeightRequest="36"
                    Clicked="OnBackClicked"
                    Background="Transparent"
                    FontSize="{OnIdiom 30, Tablet=36}"
                    Padding="0"
                    HorizontalOptions="Start"
                    VerticalOptions="Center"
                    TextColor="#AAA"
                    IsVisible="True" 
                    Margin="{OnIdiom '-17,-3,0,0', Tablet='-5,-15,0,0'}"
                    />
                <Label 
                    x:Name="TitleLabel" 
                    Grid.Row="0" 
                    Text="{Binding Title}" 
                    VerticalOptions="Center"
                    Grid.Column="1"
                    FontAttributes="Bold" 
                    Margin="{OnIdiom 0, Tablet='0,5,0,10'}"
                    FontSize="{OnIdiom Phone=20, Tablet=24, Desktop=24}"
                    TextColor="#962610" />
            <Label 
                Grid.Row="0" 
                Grid.Column="2"
                VerticalOptions="Center"
                Text="{Binding Artist}" 
                FontSize="{OnIdiom Phone=12, Tablet=18, Desktop=20}"
                TextColor="Gray" 
                Padding="0,0,-5,0"
                />

            <Button 
                Grid.Row="0"
                Grid.Column="3"
                WidthRequest="24"
                HeightRequest="24" 
                x:Name ="ScrollToggleQuick"
                Clicked="OnScrollToggleClicked"
                Background="Transparent"
                VerticalOptions="Center"
                TextColor="Black"
                FontSize="10"
                Padding="0,0,0,0"
                HorizontalOptions="End"
                Margin="{OnIdiom '0,0,-12,0'}"
                x:DataType="pages:SongDetailsPage"
                mi:MauiIcon.Value="{Binding Source={x:Reference Root}, Path=UserViewModel.PlayIcon}"
                MinimumHeightRequest="30"
                MinimumWidthRequest="30"
                />
        </Grid>

        <BoxView Grid.Row="3" HeightRequest="1" BackgroundColor="#ddd" />

        <WebView Grid.Row="4"
             x:Name="LyricsWebView"
             />

    <!-- Transparent touch area above the WebView to detect taps at the top of the page.
         Placed after WebView so it overlays it, and before ControlsPanel so controls remain top-most. -->
    <BoxView 
        x:Name="TopTouchArea"
        Grid.Row="0"
        Grid.ColumnSpan="1"
        Grid.RowSpan="3"
        HeightRequest="{OnIdiom 45, Tablet=53}"
        VerticalOptions="Start"
        BackgroundColor="Transparent"
        Opacity="0.6"
        Margin="{OnIdiom '20,0,30,0', Tablet='40,0,30,0'}"
        >
      <BoxView.GestureRecognizers>
        <TapGestureRecognizer Tapped="OnTopTouched" NumberOfTapsRequired="1" />
      </BoxView.GestureRecognizers>
    </BoxView>

    <HorizontalStackLayout x:Name="ControlsPanel"
                           Grid.Row="0"
                           Grid.RowSpan="5"
                           Padding="12"
                           Spacing="12"
                           VerticalOptions="Start"
                           BackgroundColor="#80000000"
                           IsVisible="False"
                           Opacity="0">
        <!-- bind to the UserViewModel exposed on the page with x:Reference -->
        <ImageButton
            x:Name="ScrollToggle"
            x:DataType="pages:SongDetailsPage"
            Clicked="OnScrollTogglePanelClicked"
            BackgroundColor="Transparent"
            MinimumHeightRequest="{OnIdiom Default=32, Phone=22}"
            MinimumWidthRequest="{OnIdiom Default=32, Phone=22}"
            mi:MauiIcon.Value="{Binding Source={x:Reference Root}, Path=UserViewModel.ToggleIcon}" />
        
        <ImageButton 
            Source="{mi:Fluent FontIncrease24, IconSize=30, IconColor=#FFF}"
            MinimumHeightRequest="{OnIdiom Default=32, Phone=22}"
            MinimumWidthRequest="{OnIdiom Default=32, Phone=22}"
            Clicked="OnIncreaseFontClicked" 
            />
        <ImageButton 
            Source="{mi:Fluent FontDecrease24, IconSize={OnIdiom 25, Phone=18}, IconColor=#FFF}"
            HeightRequest="{OnIdiom Default=25, Phone=18}"
            WidthRequest="{OnIdiom Default=25, Phone=18}"
            MinimumHeightRequest="{OnIdiom Default=25, Phone=18}"
            MinimumWidthRequest="{OnIdiom Default=25, Phone=18}"
            Clicked="OnDecreaseFontClicked" />
        <ImageButton 
            Source="{mi:Fluent ApprovalsApp20, IconSize=30, IconColor=#FFF}"
            MinimumHeightRequest="{OnIdiom Default=32, Phone=22}"
            MinimumWidthRequest="{OnIdiom Default=32, Phone=22}"
            Clicked="OnResetFontClicked" 
            />
            <ImageButton
                Source="{mi:Fluent MusicNote2Play20, IconSize=30, IconColor=#FFF}"
                MinimumHeightRequest="{OnIdiom Default=32, Phone=22}"
                MinimumWidthRequest="{OnIdiom Default=32, Phone=22}"
                IsVisible="Hidden"
                Clicked="OnPlayMusicClicked" 
                >
                <ImageButton.Triggers>
                    <DataTrigger 
                        TargetType="ImageButton"
                        Binding="{Binding HasSpotifyLink}"
                        Value="True">
                        <Setter Property="IsVisible" Value="Visible" />
                    </DataTrigger>
                </ImageButton.Triggers>
            </ImageButton>


            <ImageButton
                Source="{mi:FontAwesomeSolid Gear, IconSize=30, IconColor=#FFF}"
                Clicked="OnSettingsClicked"
                MinimumHeightRequest="{OnIdiom Default=32, Phone=22}"
                MinimumWidthRequest="{OnIdiom Default=32, Phone=22}"
                />

        </HorizontalStackLayout>
  </Grid>
</ContentPage>